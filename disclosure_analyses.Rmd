---
title: "Social Networks Project"
author: "Natalie Samuels"
date created: "9/5/2018"
last edited: "2/04/2019"
output: html_document
---
# Exploring the antecedents and utility of self-disclosure in college freshmen.

## Abstract
Adjusting to college is at once an exciting and stress-inducing process. One potentially helpful action students can take under stress is to disclose negative feelings to peers, thus enabling interpersonal emotion regulation and social support. However, students vary in their tendency to disclose negative feelings. Through trait data, social network nominations, and experience-sampling data, we explore trait and situational factors that influence studentsâ€™ likelihood of disclosing stressful events to dorm-mates. For ten days throughout their first quarter on campus, students reported up to three daily stressors, along with the emotional intensity and category for each, and to whom, if anyone, each stressor was disclosed. Academic stressors were most likely to be disclosed and social stressors least likely. Additionally, stressors higher in emotional intensity were more likely to be disclosed. Whereas students experiencing more depression, anxiety, and perceived stress were equally as likely as their peers to disclose negative events, students experiencing greater feelings of loneliness were significantly less likely to engage in self-disclosure. Interestingly, self-disclosure was not found to influence daily changes in mood, affect, or stress. Future research will aim to assess the utility of disclosure over longer timescales. Findings from this exploratory analysis can help inform whether self-disclosure should be encouraged as a potential avenue to buffering stress and improving well-being during the transition to college.


## Intro
Coming soon!

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Read in combined dd_trait csv and remove rows where Category is NA

# Dorm Key:
# 1 - Winter Trancos
# 2 - Spring Rinconada
# 3 - Fall Trancos
# 4 - Fall Rinconada
library(lme4)
library(lmerTest)
library(tidyverse)

dd_trait_data = read.csv(file='dd_trait_nsamuels.csv')

dd_trait_data = dd_trait_data %>% 
  filter(! is.na(Category))

dd_trait_data$GotHelp = as.factor(dd_trait_data$GotHelp)

```


```{r echo=FALSE}
# Create dummy variables for event categories

# change category variables from numeric to named factors
dd_trait_data$Category[dd_trait_data$Category == 1] = 'Soc_Rel'
dd_trait_data$Category[dd_trait_data$Category == 2] = 'School'
dd_trait_data$Category[dd_trait_data$Category == 3] = 'Health'
dd_trait_data$Category[dd_trait_data$Category == 4] = 'Fin'
dd_trait_data$Category[dd_trait_data$Category == 5] = 'Job'
dd_trait_data$Category[dd_trait_data$Category == 6] = 'Other'
dd_trait_data$Category = as.factor(dd_trait_data$Category)

# create dummy variables for event categories (indicator == School)
dd_trait_data$Cat_Soc_Rel = ifelse(dd_trait_data$Category == 'Soc_Rel', 1, 0)
dd_trait_data$Cat_Health = ifelse(dd_trait_data$Category == 'Health', 1, 0)
dd_trait_data$Cat_Fin = ifelse(dd_trait_data$Category == 'Fin', 1, 0)
dd_trait_data$Cat_Job = ifelse(dd_trait_data$Category == 'Job', 1, 0)
dd_trait_data$Cat_Other = ifelse(dd_trait_data$Category == 'Other', 1, 0)
```


```{r echo=FALSE}
# Create effect column for event valence
dd_trait_data$Val_EC = ifelse(dd_trait_data$Valence == 'Pos', 1, -1)
```


```{r echo=FALSE}
# Mean-center trait and network metrics

# create mean-center function
mean_center = function(column)
{
  as.vector(scale(column, scale=FALSE))
}

# mean-center trait metrics
dd_trait_data$STAI_MEAN_ctr = mean_center(dd_trait_data$STAI_MEAN)

dd_trait_data$CESD_avg_ctr = mean_center(dd_trait_data$CESD_avg)

dd_trait_data$Loneliness_avg_ctr = mean_center(dd_trait_data$Loneliness_avg)
dd_trait_data$Loneliness_avg_z = as.vector(scale(dd_trait_data$Loneliness_avg))

dd_trait_data$PSS_avg_ctr = mean_center(dd_trait_data$PSS_avg)

#mean-center network metrics
dd_trait_data$CloseFrd_Total_ctr = mean_center(dd_trait_data$CloseFrd_Total)
# Responsive_Total and Empathic_Total come later!
```


```{r echo=FALSE}
# subsetting dd_trait_data into pos and neg
pos_dd_trait_data = subset(dd_trait_data, (Val_EC == 1))
neg_dd_trait_data = subset(dd_trait_data, (Val_EC == -1))

```


```{r echo=FALSE}
# emotion rating for negative and positive events, person-z-scored
neg_dd_trait_data$EmoRating_pz = ave(neg_dd_trait_data$EmoRating, neg_dd_trait_data$ID, FUN=function(x) scale(x))
pos_dd_trait_data$EmoRating_pz = ave(pos_dd_trait_data$EmoRating, pos_dd_trait_data$ID, FUN=function(x) scale(x))

```


```{r echo=FALSE}
# subsetting dd_trait_data to get trait_data
trait_data = subset(dd_trait_data, (Day == 1 & EventNum == 1 & Valence == 'Pos'))

fall_trait_data = trait_data %>% 
  filter(Dorm == 3 | Dorm == 4)
```


```{r echo=FALSE}
# subsetting neg_dd_trait_data to get Fall quarter data only
fall_neg_dd_trait_data = neg_dd_trait_data %>%
  filter(Dorm == 3 | Dorm == 4)
```


## What types of stress do students experience?
```{r echo=FALSE}
# get basic descriptives for stressors
fall_neg_dd_trait_data %>% 
  group_by(ID) %>% 
  mutate(total_stressors = length(EventNum)) %>% 
  filter(row_number() == 1) %>% 
  ungroup() %>% 
  summarise(mean_stressors = mean(total_stressors), 
            sd_stressors = sd(total_stressors), 
            count_stressors = sum(total_stressors))

# setting default plot theme and text size
theme_set(
  theme_classic() + 
    theme(text = element_text(size=14))
)

# creating summary dataframe for negative events (category)
fall_neg_category_totals = fall_neg_dd_trait_data %>%
  group_by(Category, GotHelp) %>%
  summarise(count = n())

# plotting reported and disclosed negative events by category
ggplot(data = fall_neg_category_totals, 
       mapping = aes(x=Category, y=count, group=GotHelp, fill=GotHelp)) + 
  geom_bar(stat = "identity") + 
  ggtitle("Reported Stressors by Category") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # rename x-axis variables
  scale_x_discrete(limits=c("School", "Health", "Soc_Rel", "Other", "Job", "Fin"), 
                   labels=c("Fin" = "Financial", "Job" = "Work-related", "School" = "Academic", "Soc_Rel" = "Social")) + 
  ylab("Count") + 
  # edit legend labels
  scale_fill_discrete(name="Disclosed?",
                         labels=c("No", "Yes"))

```


## How emotionally intense are the stressors students experience?
```{r echo=FALSE}
# creating summary dataframe for negative events (emotion rating)
fall_neg_emo_rating_totals = fall_neg_dd_trait_data %>% 
  filter(! is.na(EmoRating)) %>% 
  group_by(EmoRating, GotHelp) %>%
  summarise(count = n())

# plotting reported and disclosed negative events by emotion rating
ggplot(data = fall_neg_emo_rating_totals, 
       mapping = aes(x=EmoRating, y=count, group=GotHelp, fill=GotHelp)) + 
  geom_bar(stat = "identity") + 
  ggtitle("Reported Stressors by Emotional Intensity") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # rename x-axis variables
  xlab("Emotional Intensity") + 
  scale_x_discrete(limits=c(1, 2, 3, 4, 5, 6, 7)) + 
  ylab("Count") + 
  ylim(0, 300) + 
  # edit legend labels
  scale_fill_discrete(name="Disclosed?",
                         labels=c("No", "Yes"))
```


## How does the emotional intensity of reported stressors vary by category?
```{r, echo=FALSE, warning=FALSE}
ggplot(data = fall_neg_dd_trait_data, 
       mapping = aes(x=Category, y=EmoRating)) + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") + 
  stat_summary(fun.y = "mean",
               geom = "point",
               shape = 23,
               size = 2.5,
               fill = "blue",
               color = "black") + 
  ggtitle("Mean Emotional Intensity of Stressors by Category") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # rename x-axis variables
  xlab("Category") + 
  # rename x-axis variables
  scale_x_discrete(limits=c("School", "Health", "Soc_Rel", "Other", "Job", "Fin"), 
                   labels=c("Fin" = "Financial", "Job" = "Work-related", "School" = "Academic", "Soc_Rel" = "Social")) + 
  ylab("Emotional Intensity") + 
  ylim(1,7)
  
```

Emotional intensity of reported stressors does not vary significantly by category.


## How does the quality of a stressor influence students' likelihood of disclosure?
```{r, echo=FALSE}
# function to convert logit to probability
logit_to_prob = function(logit) 
{
  odds = exp(logit)
  prob = odds / (1 + odds)
  return(prob)
}
```


```{r, echo=FALSE, warning=FALSE}
library(broom)

# model predicting GotHelp logit via negative event qualities
ev_qual_got_help_model = glmer(GotHelp ~ EmoRating_pz*Cat_Soc_Rel + EmoRating_pz*Cat_Health + EmoRating_pz*Cat_Fin + EmoRating_pz*Cat_Job + EmoRating_pz*Cat_Other + (1 | ID/Day) + (0 + Cat_Job | Dorm) +  (0 + Cat_Other | ID), data=fall_neg_dd_trait_data, family=binomial, control=glmerControl(optimizer='bobyqa'), na.action=na.exclude)

broom::tidy(ev_qual_got_help_model, conf.int=TRUE)

# add logit to fall negative events dataframe
fall_neg_dd_trait_data$ev_qual_got_help_logit = predict(ev_qual_got_help_model)

# convert logit to probability
fall_neg_dd_trait_data$ev_qual_got_help_prob = logit_to_prob(fall_neg_dd_trait_data$ev_qual_got_help_logit)

# plotting probability of disclosing negative events by category
ggplot(data = fall_neg_dd_trait_data, 
       mapping = aes(x=Category, y=as.numeric(as.character(GotHelp)))) + 
  # add chance line
  geom_hline(yintercept = 0.5, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.3, height = 0)) + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") + 
  stat_summary(fun.y = "mean",
               geom = "point",
               shape = 23,
               size = 2.5,
               fill = "blue",
               color = "black") +
  ggtitle("Category Predicts Probability of Diclosure") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # add caption
  #labs(caption = str_wrap("Each point represents a single reported stressor within a particular category and with a particular emotional intensity. Mixed-effects logistic regression was used to make predictions.", width = 90)) + 
  # lighten and left-align caption
  theme(plot.caption=element_text(hjust = 0, 
                                  color = "darkgray")) + 
  # rename x-axis variables
  scale_x_discrete(limits=c("School", "Health", "Other", "Soc_Rel"), 
                   labels=c("Fin" = "Financial", "Job" = "Work-related", "School" = "Academic", "Soc_Rel" = "Social")) + 
  ylab("Probability") + 
  # rescale y-axis
  scale_y_continuous(limits = c(0, 1))

# plotting probability of disclosing negative events by emotion rating (person z-scored)
ggplot(data = fall_neg_dd_trait_data, 
       mapping = aes(x=EmoRating_pz, y=as.numeric(as.character(GotHelp)))) + 
  # add chance line
  geom_hline(yintercept = 0.5, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.1, height = 0)) + 
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial"), 
              se = TRUE) + 
  ggtitle("Emotional Intensity Predicts Probability of Diclosure") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # add caption
  #labs(caption = str_wrap("Each point represents a single reported stressor within a particular category and with a particular emotional intensity. Mixed-effects logistic regression was used to make predictions. Emotional intensity ratings are within-person z-scored.", width = 90)) + 
  # lighten and left-align caption
  theme(plot.caption=element_text(hjust = 0, 
                                  color = "darkgray")) + 
  # rename x-axis variables
  xlab("Emotional Intensity (SD)") + 
  ylab("Probability") + 
  # rescale y-axis
  scale_y_continuous(limits = c(0, 1))

```

Students are most likely to disclose academic stressors to their peers and are slightly more likely than chance to disclose health-related stressors. Interestingly, students are slightly less likely than chance to disclose social stressors. Students are also more likely to disclose stressors that are higher in emotional intensity.


## How do students' individual differences influence their likelihood of disclosure?
```{r, echo=FALSE, warning=FALSE}
loneliness_got_help_model = glmer(GotHelp ~ EmoRating_pz*Loneliness_avg_ctr + CloseFrd_Total_ctr*Loneliness_avg_ctr + (1 | ID), data=fall_neg_dd_trait_data, family=binomial, control=glmerControl(optimizer='bobyqa'), na.action=na.exclude)

broom::tidy(loneliness_got_help_model, conf.int=TRUE)

# add logit to fall negative events dataframe
fall_neg_dd_trait_data$loneliness_got_help_logit = predict(loneliness_got_help_model)

# convert logit to probability
fall_neg_dd_trait_data$loneliness_got_help_prob = logit_to_prob(fall_neg_dd_trait_data$loneliness_got_help_logit)

# plotting probability of disclosing negative events by loneliness
ggplot(data = fall_neg_dd_trait_data, 
       mapping = aes(x=Loneliness_avg_z, y=as.numeric(as.character(GotHelp)))) + 
  # add chance line
  geom_hline(yintercept = 0.5, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.1, height = 0)) + 
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial"), 
              se = FALSE, 
              aes(group = factor(CloseFrd_Total), 
                  color = factor(CloseFrd_Total)), 
              size = 0.75) + 
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial"), 
              se = TRUE, 
              color = "darkblue", 
              size = 1) +
  ggtitle("Perceived Loneliness Predicts Diclosure") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  # add caption
  #labs(caption = str_wrap("Each point represents a student with a particular loneliness rating and number of close friends experiencing a stressor with a particular emotional intensity. Mixed-effects logistic regression was used to make predictions. Loneliness ratings are z-scored.", width = 90)) + 
  # lighten and left-align caption
  theme(plot.caption=element_text(hjust = 0, 
                                  color = "darkgray")) + 
  # rename x-axis variables
  xlab("Loneliness (SD)") + 
  ylab("Probability of Disclosure (SD)") + 
  # rescale y-axis
  scale_y_continuous(limits = c(0, 1)) + 
  # edit legend labels
  scale_color_discrete(name = "# Close\nFriends")

```

Students who experience more loneliness are less likely than their peers to disclose stressful events, regardless of the objective number of friendships the student reports having. Trait anxiety, depression, and perceived stress were also tested in separate models, but none emerged as significant predictors of disclosure.


## How do students' perceptions of their social environments predict their likelihood of disclosure?
```{r, echo=FALSE, warning=FALSE}
# refresh fall_neg_dd_trait_data
fall_neg_dd_trait_data = dd_trait_data %>% 
  filter(Val_EC == -1) %>% 
  group_by(ID) %>% 
  mutate(EmoRating_pz = scale(EmoRating)) %>% 
  ungroup() %>% 
  filter(Dorm == 3 | Dorm == 4)

# preparing aggregate disclosure ratio and centering outdegree
fall_neg_dd_trait_data = fall_neg_dd_trait_data %>% 
  group_by(ID) %>% 
  mutate(stressor_count_agg = length(EventNum)) %>% 
  mutate(disclosure_count_agg = sum(as.numeric(as.character(GotHelp)))) %>% 
  mutate(disclosure_ratio_agg = disclosure_count_agg / stressor_count_agg) %>% 
  ungroup() %>% 
  mutate(disclosure_ratio_agg_z = scale(disclosure_ratio_agg)) %>% 
  mutate_at(vars(Responsive_Total, Empathic_Total), 
            funs(z = scale(.)))

# add disclosure ratio and responsive / empathic outdegree to trait data
fall_trait_data['disclosure_ratio_agg_z'] = 
  fall_neg_dd_trait_data$disclosure_ratio_agg_z[match(fall_trait_data$ID, 
                                                      fall_neg_dd_trait_data$ID)]

fall_trait_data['Responsive_Total_z'] = 
  fall_neg_dd_trait_data$Responsive_Total_z[match(fall_trait_data$ID, 
                                                      fall_neg_dd_trait_data$ID)]

fall_trait_data['Empathic_Total_z'] = 
  fall_neg_dd_trait_data$Empathic_Total_z[match(fall_trait_data$ID, 
                                                      fall_neg_dd_trait_data$ID)]

# does trait loneliness predict rate of disclosure? [YES]
lonely_disclosure_rate_model = 
  lm(disclosure_ratio_agg_z ~ Loneliness_avg_z + CloseFrd_Total_ctr, data = fall_trait_data)

# plotting disclosure by trait loneliness
ggplot(data = fall_trait_data, 
       mapping = aes(x=Loneliness_avg_z, y=disclosure_ratio_agg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.1, height = 0)) + 
  geom_smooth(method = "lm", 
              se = FALSE, 
              aes(group = factor(CloseFrd_Total), 
                  color = factor(CloseFrd_Total)), 
              size = 0.75) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Perceived Loneliness Predicts Disclosure") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Loneliness (SD)") + 
  ylab("Rate of Disclosure (SD)") + 
  # edit legend labels
  scale_color_discrete(name = "# Close\nFriends")

```


```{r, echo=FALSE, warning=FALSE}

# does empathy of network predict rate of disclosure? [NO]
empathic_net_got_help_model = 
  lm(disclosure_ratio_agg_z ~ Empathic_Total_z, data = fall_trait_data)

# plotting disclosure by empathy network outdegree
# ggplot(data = fall_trait_data, 
#        mapping = aes(x=Empathic_Total_z, y=disclosure_ratio_agg_z)) + 
#   # add line denoting mean within a student
#   geom_hline(yintercept = 0, 
#              linetype = "dashed") + 
#   geom_point(alpha = 0.2,
#              size = 1, 
#              position  = position_jitter(width = 0.1, height = 0)) + 
#   geom_smooth(method = "lm", 
#               se = TRUE, 
#               color = "darkblue", 
#               size = 1) + 
#   ggtitle("Empathy of Network Predicts Disclosure") + 
#   # center plot title
#   theme(plot.title = element_text(hjust = 0.5)) + 
#   xlab("Empathic Outdegree (SD)") + 
#   # rename x axis labels
#   #scale_x_continuous(limits = c(-2.25, 2.25)) + 
#   ylab("Rate of Disclosure (SD)") + 
#   # rescale y-axis
#   #scale_y_continuous(limits = c(-2.5, 2.5))

```


```{r, echo=FALSE, warning=FALSE}

# does responsiveness of network predict disclosure? [NO]
responsive_net_got_help_model = 
  lm(disclosure_ratio_agg_z ~ Responsive_Total_z, data = fall_trait_data)

# plotting disclosure by empathy network outdegree
# ggplot(data = fall_neg_dd_trait_data, 
#        mapping = aes(x=Responsive_Total_z, y=disclosure_ratio_agg_z)) + 
#   # add line denoting mean within a student
#   geom_hline(yintercept = 0, 
#              linetype = "dashed") + 
#   geom_point(alpha = 0.2,
#              size = 1, 
#              position  = position_jitter(width = 0.1, height = 0)) + 
#   geom_smooth(method = "lm", 
#               se = TRUE, 
#               color = "darkblue", 
#               size = 1) + 
#   ggtitle("Responsiveness of Network Predicts Disclosure") + 
#   # center plot title
#   theme(plot.title = element_text(hjust = 0.5)) + 
#   xlab("Responsive Outdegree (SD)") + 
#   # rename x axis labels
#   scale_x_continuous(limits = c(-2.25, 2.25)) + 
#   ylab("Rate of Disclosure (SD)") + 
#   # rescale y-axis
#   scale_y_continuous(limits = c(-2.5, 2.5))

```

Attributes of students' social networks were used to predict their likelihood of disclosure. Neither the number of empathic friends nor the number responsive friends a student reports having in their dorm predict significant differences in rate of disclosure. Perceptions of social isolation, however, is a significant predictor of rate of disclosure.


## How do students' perceptions of their social environments predict their feelings of social integration?
```{r, echo=FALSE, warning=FALSE}

# does empathy of network predict trait loneliness? [NO]
empathic_net_lonely_model = 
  lm(Loneliness_avg_z ~ Empathic_Total_z, data = fall_trait_data)

# does responsiveness of network predict trait loneliness? [YES]
responsive_net_lonely_model = 
  lm(Loneliness_avg_z ~ Responsive_Total_z, data = fall_trait_data)

# plotting loneliness by responsive network outdegree
ggplot(data = fall_trait_data,
       mapping = aes(x=Responsive_Total_z, y=Loneliness_avg_z)) +
  # add line denoting mean within a student
  geom_hline(yintercept = 0,
             linetype = "dashed") +
  geom_point(alpha = 0.2,
             size = 1,
             position  = position_jitter(width = 0.1, height = 0)) +
  geom_smooth(method = "lm",
              se = TRUE,
              color = "darkblue",
              size = 1) +
  ggtitle("Perceived Responsiveness of Network Predicts Loneliness") +
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("Responsive Outdegree (SD)") +
  ylab("Loneliness (SD)")

```

Students who perceive their social envionments to be more responsive report feeling less socially isolated. Perceived empathy of one's social environment does not predict feelings of social islation.


## What is the utility of disclosing negative events to dorm-mates?
```{r echo=FALSE}
# create reverse-scoring functions

# reverse-scoring loneliness
fun.reverse_lonely = function(response) {
  cleaned_reponse = 8 - response
  return(cleaned_reponse)
}

# reverse-scoring perceived stress
fun.reverse_stress = function(response) {
  cleaned_reponse = 8 - response
  return(cleaned_reponse)
}
```


```{r, echo=FALSE, warning=FALSE}
# prepare daily emotion data (person z-score)

fall_neg_dd_trait_data = fall_neg_dd_trait_data %>% 
  group_by(ID, Day) %>% 
  # average daily life satisfaction
  mutate(LifSat_day_avg = mean(c(LifSat_1, LifSat_2, LifSat_3, LifSat_4, LifSat_5))) %>% 
  # average daily loneliness
  mutate_at(vars(Lonely_1, Lonely_3, Lonely_6), funs(fun.reverse_lonely(.))) %>% 
  mutate(Lonely_day_avg = mean(c(Lonely_1, Lonely_2, Lonely_3, Lonely_4, Lonely_5, Lonely_6))) %>% 
  # average daily positive emotion
  mutate(PosAff_day_avg = mean(c(PosNegEmo_Happy, PosNegEmo_Enthusiastic, PosNegEmo_Joyful, PosNegEmo_Amused, PosNegEmo_Proud))) %>% 
  # average daily negative emotion
  mutate(NegAff_day_avg = mean(c(PosNegEmo_Guilty, PosNegEmo_Ashamed, PosNegEmo_Nervous, PosNegEmo_Angry, PosNegEmo_Sad))) %>% 
  # average daily stress
  mutate_at(vars(PSS_2, PSS_3), funs(fun.reverse_lonely(.))) %>% 
  mutate(Stress_day_avg = mean(c(PSS_1, PSS_2, PSS_3, PSS_4))) %>% 
  ungroup() %>% 
  # remove original daily emotion ratings
  select(-(LifSat_1:PSS_4)) %>% 
  # create aggregate daily pos and neg wellbeing columns
  group_by(ID, Day) %>% 
  mutate(pos_wellbeing = mean(c(LifSat_day_avg, PosAff_day_avg))) %>% 
  mutate(neg_wellbeing = mean(c(Lonely_day_avg, NegAff_day_avg, Stress_day_avg))) %>% 
  ungroup() %>% 
  # person z-score daily emotion data
  group_by(ID) %>% 
  mutate_at(vars(LifSat_day_avg, Lonely_day_avg, PosAff_day_avg, NegAff_day_avg, Stress_day_avg, 
                 pos_wellbeing, neg_wellbeing), 
            funs(pz = scale(.)))

```


```{r, echo=FALSE, include=FALSE}
# assessing the utility of disclosure by predicting same-day wellbeing

# preparing daily diary data
fall_neg_dd_trait_data_utility_sd = fall_neg_dd_trait_data %>% 
  # create effect column for GotHelp
  mutate(GotHelp = ifelse(GotHelp == 1, 1, -1)) %>% 
  # create column for magnitude of stressors experienced each day (person-centered)
  group_by(ID, Day) %>% 
  mutate(EmoRating_day_mag = sum(EmoRating, na.rm = TRUE)) %>% 
  # create daily disclosure ratio
  mutate(stressor_count = length(EventNum)) %>% 
  mutate(disclosure_count = sum(as.numeric(as.character(GotHelp)))) %>% 
  mutate(disclosure_ratio = disclosure_count / stressor_count) %>% 
  ungroup() %>% 
  # person-z-score disclosure ratio and center daily emotion rating
  group_by(ID) %>% 
  mutate(disclosure_ratio_pz = scale(disclosure_ratio)) %>% 
  mutate(EmoRating_day_mag_ctr = mean_center(EmoRating_day_mag)) %>% 
  ungroup() %>% 
  # select relevant columns for utility analyses
  select(ID, Day, disclosure_ratio_pz, EmoRating_day_mag_ctr, Responsive_Total_z, Loneliness_avg_z,
         LifSat_day_avg_pz, Lonely_day_avg_pz, PosAff_day_avg_pz, NegAff_day_avg_pz,
         Stress_day_avg_pz, pos_wellbeing_pz, neg_wellbeing_pz) %>% 
  unique()

# does disclosure predict same-day positive markers of wellbeing? [NO]
utility_sd_pos_wb_model = lm(pos_wellbeing_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_sd_pos_wb_model, conf.int=TRUE)

# does disclosure predict same-day negative markers of wellbeing? [NO]
utility_sd_neg_wb_model = lm(neg_wellbeing_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_sd_neg_wb_model, conf.int=TRUE)

# does disclosure predict same-day satisfaction with day? [NO]
utility_lifsat_model_sd = lm(LifSat_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_lifsat_model_sd, conf.int=TRUE)

# does disclosure predict same-day loneliness? [NO]
utility_lonely_model_sd = lm(Lonely_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_lonely_model_sd, conf.int=TRUE)

# does disclosure predict same-day positive affect? [NO]
utility_posaff_model_sd = lm(PosAff_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_posaff_model_sd, conf.int=TRUE)

# does disclosure predict same-day negative affect? [NO]
utility_negaff_model_sd = lm(NegAff_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_negaff_model_sd, conf.int=TRUE)

# does disclosure predict same-day stress? [NO]
utility_stress_model_sd = lm(Stress_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(utility_stress_model_sd, conf.int=TRUE)

```


```{r, echo=FALSE, warning=FALSE}
# plotting loneliness by disclosure
broom::tidy(utility_lonely_model_sd, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_utility_sd, 
       mapping = aes(x=disclosure_ratio_pz, y=Lonely_day_avg_pz)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Disclosure Predicts Perceived Loneliness") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Rate of Disclosure (SD)") + 
  # rename x axis labels
  scale_x_continuous(limits = c(-4, 3)) + 
  ylab("Loneliness (SD)") + 
  # rescale y-axis
  scale_y_continuous(limits = c(-3, 3))

# plotting negative affect by disclosure
broom::tidy(utility_negaff_model_sd, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_utility_sd, 
       mapping = aes(x=disclosure_ratio_pz, y=NegAff_day_avg_pz)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Disclosure Predicts Negative Affect") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Rate of Disclosure (SD)") + 
  # rename x axis labels
  scale_x_continuous(limits = c(-4, 3)) + 
  ylab("Negative Affect (SD)") + 
  # rescale y-axis
  scale_y_continuous(limits = c(-3, 3))

# plotting stress by disclosure
broom::tidy(utility_stress_model_sd, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_utility_sd, 
       mapping = aes(x=disclosure_ratio_pz, y=Stress_day_avg_pz)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Disclosure Predicts Perceived Stress") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Rate of Disclosure (SD)") + 
  # rename x axis labels
  scale_x_continuous(limits = c(-4, 3)) + 
  ylab("Perceived Stress (SD)") + 
  # rescale y-axis
  scale_y_continuous(limits = c(-3, 3))

```

Students' perceived loneliness, negative affect, and perceived stress are lower on days when they disclose a higher proportion of their stressors to peers, regardless of the magnitude of stress they experienced that day. Interstingly, rate of stress disclosure does not predict positive affect or satisfaction with day.


## How do students' perceptions of their social environments predict daily well-being?
```{r, echo=FALSE, include=FALSE}
# preparing daily diary data
fall_neg_dd_trait_data_soc_perc_wb_sd = fall_neg_dd_trait_data %>% 
  # create column for magnitude of stressors experienced each day (person-centered)
  group_by(ID, Day) %>% 
  mutate(EmoRating_day_mag = sum(EmoRating, na.rm = TRUE)) %>% 
  ungroup() %>% 
  # person-center daily emotion rating
  group_by(ID) %>% 
  mutate(EmoRating_day_mag_ctr = mean_center(EmoRating_day_mag)) %>% 
  ungroup() %>% 
  # z-score daily emotion data
  group_by(Day) %>% 
  mutate_at(vars(LifSat_day_avg, Lonely_day_avg, PosAff_day_avg, NegAff_day_avg, Stress_day_avg), 
            funs(z = scale(.))) %>% 
  ungroup() %>% 
  # select relevant columns for utility analyses
  select(ID, Day, EmoRating_day_mag_ctr, Responsive_Total_z, Empathic_Total_z, Loneliness_avg_z, 
         LifSat_day_avg_z, Lonely_day_avg_z, PosAff_day_avg_z, NegAff_day_avg_z, Stress_day_avg_z) %>% 
  unique()

```


```{r, echo=FALSE, include=FALSE}

# does trait loneliness predict daily loneliness? [YES]
trait_lonely_sd_lonely_model = lm(Lonely_day_avg_z ~ Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(trait_lonely_sd_lonely_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Loneliness_avg_z, y=Lonely_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Trait Loneliness Predicts Daily Loneliness") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Trait Loneliness (SD)") + 
  ylab("Daily Loneliness (SD)")

# does trait loneliness predict daily negative affect? [YES]
trait_lonely_sd_negaff_model = lm(NegAff_day_avg_z ~ Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(trait_lonely_sd_negaff_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Loneliness_avg_z, y=NegAff_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Trait Loneliness Predicts Daily Negative Affect") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Trait Loneliness (SD)") + 
  ylab("Daily Negatie Affect (SD)")

# does trait loneliness predict daily stress? [YES]
trait_lonely_sd_stress_model = lm(Stress_day_avg_z ~ Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(trait_lonely_sd_stress_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Loneliness_avg_z, y=Stress_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Trait Loneliness Predicts Daily Stress") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Trait Loneliness (SD)") + 
  ylab("Daily Stress (SD)")

```


```{r, echo=FALSE, include=FALSE}

# does empathy of network predict daily loneliness? [NO]
emp_net_sd_lonely_model = lm(Lonely_day_avg_z ~ Empathic_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(emp_net_sd_lonely_model, conf.int=TRUE)

# does empathy of network predict daily negative affect? [NO]
emp_net_sd_negaff_model = lm(NegAff_day_avg_z ~ Empathic_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(emp_net_sd_negaff_model, conf.int=TRUE)

# does empathy of network predict daily stress? [YES - WEAK]
emp_net_sd_stress_model = lm(Stress_day_avg_z ~ Empathic_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(emp_net_sd_stress_model, conf.int=TRUE)

```


```{r, echo=FALSE, include=FALSE}

# does responsiveness of network predict daily loneliness? [YES]
resp_net_sd_lonely_model = lm(Lonely_day_avg_z ~ Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(resp_net_sd_lonely_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Responsive_Total_z, y=Lonely_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Perceived Responsiveness of Network Predicts Daily Loneliness") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Responsive Outdegree (SD)") + 
  ylab("Daily Loneliness (SD)")

# does responsiveness of network predict daily negative affect? [YES]
resp_net_sd_negaff_model = lm(NegAff_day_avg_z ~ Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(resp_net_sd_negaff_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Responsive_Total_z, y=NegAff_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Perceived Responsiveness of Network Predicts Daily Negative Affect") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Responsive Outdegree (SD)") + 
  ylab("Daily Negative Affect (SD)")

# does responsiveness of network predict daily stress? [YES - WEAK]
resp_net_sd_stress_model = lm(Stress_day_avg_z ~ Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_soc_perc_wb_sd, na.action=na.exclude)

broom::tidy(resp_net_sd_stress_model, conf.int=TRUE)

ggplot(data = fall_neg_dd_trait_data_soc_perc_wb_sd, 
       mapping = aes(x=Responsive_Total_z, y=Stress_day_avg_z)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Perceived Responsiveness of Network Predicts Daily Stress") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Responsive Outdegree (SD)") + 
  ylab("Daily Stress (SD)")

```

Students who perceive their networks to be more responsive and who feel more socially connected tend to experience better daily well-being.


## Is the relationship between disclosure and daily wellbeing moderated by trait loneliness?
``` {r, echo=FALSE, include=FALSE}

# does trait loneliness moderate the relationship disclosure and daily loneliness? [NO]
lonely_mod_disc_sd_lonely_model = lm(Lonely_day_avg_pz ~ disclosure_ratio_pz*Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(lonely_mod_disc_sd_lonely_model, conf.int=TRUE)

# does trait loneliness moderate the relationship disclosure and daily negative affect? [NO]
lonely_mod_disc_sd_negaff_model = lm(NegAff_day_avg_pz ~ disclosure_ratio_pz*Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(lonely_mod_disc_sd_negaff_model, conf.int=TRUE)

# does trait loneliness moderate the relationship disclosure and daily stress? [NO]
lonely_mod_disc_sd_stress_model = lm(Stress_day_avg_pz ~ disclosure_ratio_pz*Loneliness_avg_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(lonely_mod_disc_sd_stress_model, conf.int=TRUE)

```

The relationship between disclosure and daily wellbeing is not moderated by trait loneliness for any of the "negative" measures of wellbeing. This suggests that students high in trait loneliness may still benefit from disclosing their stress to peers. 


## Is the relationship between disclosure and daily wellbeing moderated by perceived responsiveness?

Does perceived responsiveness moderate the relationship between disclosure and daily loneliness?
``` {r, echo=FALSE, include=FALSE}

# NO
perc_resp_mod_disc_sd_lonely_model = lm(Lonely_day_avg_pz ~ disclosure_ratio_pz*Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(perc_resp_mod_disc_sd_lonely_model, conf.int=TRUE)
```


Does perceived responsiveness moderate the relationship between disclosure and daily negative affect?
``` {r, echo=FALSE, include=FALSE}

# YES
perc_resp_mod_disc_sd_negaff_model = lm(NegAff_day_avg_pz ~ disclosure_ratio_pz*Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(perc_resp_mod_disc_sd_negaff_model, conf.int=TRUE)

# median split perceived responsiveness for simple effects model
median_perc_resp = median(fall_neg_dd_trait_data_utility_sd$Responsive_Total_z, na.rm=TRUE)

fall_neg_dd_trait_data_utility_sd$Responsive_Total_med_split = 
  ifelse(fall_neg_dd_trait_data_utility_sd$Responsive_Total_z > median_perc_resp, 
         'hi', 'lo')

# simple effect: high perceived responsiveness [b = 0.08, NS]
hi_perc_resp_mod_disc_sd_negaff_model = fall_neg_dd_trait_data_utility_sd %>% 
  filter(Responsive_Total_med_split == 'hi') %>% 
  lm(NegAff_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr,
     data = ., na.action=na.exclude)

# simple effect: low perceived responsiveness [b = -0.17, ***]
lo_perc_resp_mod_disc_sd_negaff_model = fall_neg_dd_trait_data_utility_sd %>% 
  filter(Responsive_Total_med_split == 'lo') %>% 
  lm(NegAff_day_avg_pz ~ disclosure_ratio_pz + EmoRating_day_mag_ctr,
     data = ., na.action=na.exclude)

# plot negative affect as a function of disclosure grouped by perceived responsiveness
ggplot(data = fall_neg_dd_trait_data_utility_sd, 
       mapping = aes(x=disclosure_ratio_pz, y=NegAff_day_avg_pz)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.2, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              aes(group = factor(Responsive_Total_med_split), 
                  color = factor(Responsive_Total_med_split)),
              size = 1) + 
  ggtitle("Perceived Responsiveness Moderates Disclosure-Negative Affect Relationship") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Rate of Disclosure (SD)") + 
  ylab("Negative Affect (SD)") +
  # edit legend labels
  scale_color_discrete(name = "Perceived\nResponsiveness")

```


Does perceived responsiveness moderate the relationship between disclosure and daily stress?
``` {r, echo=FALSE, include=FALSE}

# NO
perc_resp_mod_disc_sd_stress_model = lm(Stress_day_avg_pz ~ disclosure_ratio_pz*Responsive_Total_z + EmoRating_day_mag_ctr, data = fall_neg_dd_trait_data_utility_sd, na.action=na.exclude)

broom::tidy(perc_resp_mod_disc_sd_stress_model, conf.int=TRUE)

```

For students who are low in perceived resonsiveness, disclosure is more tightly linked to same-day negative affect. This suggests that students who are low in perceived resposiveness may see greater relief from negative affect than their peers when disclosing their stress.

## Daily Ambient Empathy
``` {r, echo=FALSE, include=FALSE}
library(stringr)

# read in and prepare daily event data (pull and reshape daily disclosure targets)
dd_event_data = read.csv(file="DD_event_data_allDorms_nsamuels.csv")
pid_roster = read.csv(file="PIDRoster_All4Dorms.csv")

# filter for fall negative event data only
fall_neg_dd_event_data = dd_event_data %>% 
  filter(Dorm == 3 | Dorm == 4) %>% 
  select(ID, Dorm, Day, Dormmates_1:Dormmates_5, DrmNgEvTld1_1:DrmNgEvTld4_5)

# function to assign disclosure targets to negative events
fun.assign_disclosure_target = function(old_col_name, dormmate) 
{
  ifelse(fall_neg_dd_event_data[[old_col_name]] == 1, 
         as.character(fall_neg_dd_event_data[[dormmate]]), NA)
}

# assign disclosure targets to negative event 1
fall_neg_dd_event_data$NegEv1_1 = fun.assign_disclosure_target("DrmNgEvTld1_1", "Dormmates_1")
fall_neg_dd_event_data$NegEv1_2 = fun.assign_disclosure_target("DrmNgEvTld1_2", "Dormmates_2")
fall_neg_dd_event_data$NegEv1_3 = fun.assign_disclosure_target("DrmNgEvTld1_3", "Dormmates_3")
fall_neg_dd_event_data$NegEv1_4 = fun.assign_disclosure_target("DrmNgEvTld1_4", "Dormmates_4")
fall_neg_dd_event_data$NegEv1_5 = fun.assign_disclosure_target("DrmNgEvTld1_5", "Dormmates_5")

# assign disclosure targets to negative event 2
fall_neg_dd_event_data$NegEv2_1 = fun.assign_disclosure_target("DrmNgEvTld2_1", "Dormmates_1")
fall_neg_dd_event_data$NegEv2_2 = fun.assign_disclosure_target("DrmNgEvTld2_2", "Dormmates_2")
fall_neg_dd_event_data$NegEv2_3 = fun.assign_disclosure_target("DrmNgEvTld2_3", "Dormmates_3")
fall_neg_dd_event_data$NegEv2_4 = fun.assign_disclosure_target("DrmNgEvTld2_4", "Dormmates_4")
fall_neg_dd_event_data$NegEv2_5 = fun.assign_disclosure_target("DrmNgEvTld2_5", "Dormmates_5")

# assign disclosure targets to negative event 3
fall_neg_dd_event_data$NegEv3_1 = fun.assign_disclosure_target("DrmNgEvTld3_1", "Dormmates_1")
fall_neg_dd_event_data$NegEv3_2 = fun.assign_disclosure_target("DrmNgEvTld3_2", "Dormmates_2")
fall_neg_dd_event_data$NegEv3_3 = fun.assign_disclosure_target("DrmNgEvTld3_3", "Dormmates_3")
fall_neg_dd_event_data$NegEv3_4 = fun.assign_disclosure_target("DrmNgEvTld3_4", "Dormmates_4")
fall_neg_dd_event_data$NegEv3_5 = fun.assign_disclosure_target("DrmNgEvTld3_5", "Dormmates_5")

fall_neg_dd_event_data = fall_neg_dd_event_data %>% 
  select(ID, Dorm, Day, NegEv1_1:NegEv3_5) %>% 
  gather(key = "EventNum", value = "dormmate_name", NegEv1_1:NegEv3_5)

# clean up event numbers and disclosure target names and add valence column
fall_neg_dd_event_data$EventNum = as.numeric(str_match(fall_neg_dd_event_data$EventNum,
                                            "NegEv(.*?)_")[, 2])
fall_neg_dd_event_data$Valence = "Neg"

fun.replace_name = function(old_name, new_name) 
{
  gsub(old_name, new_name, fall_neg_dd_event_data$dormmate_name)
}

fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Sam Ginn$", "Sameul Ginn")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^sam ginn$", "Sameul Ginn")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Joseph$", "Joseph Hurlocker") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Joey Hurlocker$", "Joseph Hurlocker")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Nicel$", "Nicel Mohamed-Hinds")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Nicel $", "Nicel Mohamed-Hinds")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Nicel Muhammed$", "Nicel Mohamed-Hinds")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Nicel Mohammed$", "Nicel Mohamed-Hinds")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Megan$", "Megan Rowe")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Lulu$", "Marilu Bravo")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Max Holland$", "Max Horland")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Astrid$", "Astrid Casimire")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Jenny$", "Jenny Han")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Jenny $", "Jenny Han")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Carolyn's Lee $", "Carolyn Lee") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Enoch park$", "Enoch Park") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Enoch$", "Enoch Park") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Lara Ecalavge $", "Lara Elcavage") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Lara Eclavage$", "Lara Elcavage") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Lea Koob $", "Lea Koob") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Deedee Anderson$", "Deanna Anderson")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Cody carlton$", "Cody Carlton") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Deedee Anderson $", "Deanna Anderson")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Matt Lara$", "Matthew Lara") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Brendan Edelson $", "Brendan Edelson")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Samuel Ginn$", "Sameul Ginn") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^maurice Chiang $", "Maurice Chiang") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Maurice chiang$", "Maurice Chiang") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Eleni Alexandraki $", "Eleni Alexandraki") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Vicky$", "Vicky Le") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Selwin george$", "Selwin George") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^jackson lallas$", "Jackson Lallas") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Cindy$", "Cindy Nguyen") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Christopher Koenig $", "Christopher Koenig")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Matt Lara $", "Matthew Lara") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Claudia$", "Claudia Hanley")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Claudia Hanley $", "Claudia Hanley") 
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Astrid $", "Astrid Casimire")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Albert$", "Albert Liang")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Dylan$", "Dylan Harding")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Beck goodloe$", "Beck Goodloe")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Amy Couch$", "Amy Kouch")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Hope$", "Hope Harrington")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Cody Carlton $", "Cody Carlton")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Arielle$", "Arielle Rodriguez ")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Marilou Bravo$", "Marilu Bravo")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Shelby Parks $", "Shelby Parks")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^miguel Vera$", "Miguel Vera")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Megan$", "Megan Rowe")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Edric$", "Edric Zeng")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Dylan Harding $", "Dylan Harding")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Donny$", "Donny Flynn")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Leni Peterson $", "Leni Peterson")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^flora wang$", "Flora Wang")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Andrea Ramirez Oviedo$", "Andrea Ramirez")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Mad Horland$", "Max Horland")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Daniel parra$", "Daniel Parra")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Lucas Isaza $", "Lucas Isaza")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^arielle rodriguez$", "Arielle Rodriguez")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Dana Chu Tung$", "Dana Tung")
fall_neg_dd_event_data$dormmate_name = fun.replace_name("^Mark ferguson$", "Mark Ferguson")

# replace disclosure target names with IDs
fall_neg_dd_event_data["dormmate_id"] = 
  pid_roster$ID[match(fall_neg_dd_event_data$dormmate_name, pid_roster$Name)]

# match disclosure target IDs with empathy scores (IRI_EC, IRI_PT, PSA_avg, LTES_avg)
fall_neg_dd_event_data["dormmate_IRI_EC"] = 
  fall_neg_dd_trait_data$IRI_EC[match(fall_neg_dd_event_data$dormmate_id,
                                       fall_neg_dd_trait_data$ID)]
fall_neg_dd_event_data["dormmate_IRI_PT"] = 
  fall_neg_dd_trait_data$IRI_PT[match(fall_neg_dd_event_data$dormmate_id,
                                       fall_neg_dd_trait_data$ID)]
fall_neg_dd_event_data["dormmate_PSA_avg"] = 
  fall_neg_dd_trait_data$PSA_avg[match(fall_neg_dd_event_data$dormmate_id,
                                       fall_neg_dd_trait_data$ID)]
fall_neg_dd_event_data["dormmate_LTES_avg"] = 
  fall_neg_dd_trait_data$LTES_avg[match(fall_neg_dd_event_data$dormmate_id,
                                       fall_neg_dd_trait_data$ID)]

# compute daily ambient empathy
fall_neg_daily_amb_emp_data = fall_neg_dd_event_data %>% 
  # compute mean empathy of disclosure targets
  rowwise() %>% 
  mutate(disc_target_empathy = mean(c(dormmate_IRI_EC, dormmate_IRI_PT, 
                                      dormmate_PSA_avg, dormmate_LTES_avg))) %>% 
  ungroup() %>% 
  # compute daily ambient empathy
  group_by(ID, Day) %>% 
  mutate(ambient_empathy_day = mean(disc_target_empathy, na.rm=TRUE)) %>% 
  ungroup() %>% 
  # person-z-score daily ambient empathy
  group_by(ID) %>% 
  mutate(ambient_empathy_day_pz = scale(ambient_empathy_day)) %>% 
  ungroup() %>% 
  select(ID, Dorm, Day, Valence, EventNum, ambient_empathy_day_pz)
  
# prep daiy stress data

# create column for magnitude of stressors experienced each day (person-centered)
# and select releant columns for daiy ambient empathy analysis
fall_daily_stress_data = fall_neg_dd_trait_data %>% 
  group_by(ID, Day) %>% 
  mutate(EmoRating_day_mag = sum(EmoRating, na.rm = TRUE)) %>% 
  ungroup() %>% 
  group_by(ID) %>% 
  mutate(EmoRating_day_mag_pz = scale(EmoRating_day_mag)) %>% 
  ungroup() %>% 
  select(ID, Dorm, Day, Valence, EventNum, EmoRating_day_mag_pz, Stress_day_avg_pz, 
         Empathic_Total_z, Responsive_Total_z)

# add daily stress data to daily ambient empathy dataframe
fall_neg_daily_amb_emp_data = left_join(fall_neg_daily_amb_emp_data, fall_daily_stress_data, 
          by = c("ID", "Dorm", "Day", "Valence", "EventNum"))

```


``` {r ambient empathy analyses, echo=FALSE, include=FALSE}

# does daily objective stress predict daily preceived stress? [YES]
obj_perc_stress_model = lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz, data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# does daily objective stress predict daily ambient empathy? [NO]
obj_stress_amb_emp_model = lm(ambient_empathy_day_pz ~ EmoRating_day_mag_pz, data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# does daily perceived stress predict daily ambient empathy? [NO]
perc_stress_amb_emp_model = lm(ambient_empathy_day_pz ~ Stress_day_avg_pz, data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# plotting daily ambient empathy by daily objective stress
ggplot(data = unique(fall_neg_daily_amb_emp_data), 
       mapping = aes(x=EmoRating_day_mag_pz, y=ambient_empathy_day_pz)) + 
  # add line denoting mean within a student
  geom_hline(yintercept = 0, 
             linetype = "dashed") + 
  geom_point(data = unique(fall_neg_daily_amb_emp_data), 
             alpha = 0.2,
             size = 1, 
             position  = position_jitter(width = 0.1, height = 0)) + 
  geom_smooth(method = "lm", 
              se = TRUE, 
              color = "darkblue", 
              size = 1) + 
  ggtitle("Daily Stress Predicts Daily Ambient Empathy") + 
  # center plot title
  theme(plot.title = element_text(hjust = 0.5)) + 
  xlab("Magnitude of Stress (SD)") + 
  # rename x axis labels
  scale_x_continuous(limits = c(-2.75, 2.75)) + 
  ylab("Ambient Empathy (SD)") + 
  # rescale y-axis
  scale_y_continuous(limits = c(-2, 2))

# does daily ambient empathy moderate the relationship between objective stress 
# and preceived stress? [NO]
amb_emp_mod_stress_model = lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz:ambient_empathy_day_pz,
                              data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# does overall ambient empathy moderate the relationship between objective stress 
# and preceived stress? [NO]
agg_amb_emp_mod_stress_model = lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz:Empathic_Total_z,
                              data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# does overall ambient responsiveness moderate the relationship between objective stress 
# and preceived stress? [NO]
agg_amb_resp_mod_stress_model = lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz:Responsive_Total_z,
                              data = unique(fall_neg_daily_amb_emp_data), na.action=na.exclude)

# median split ambient responsiveness for simple effects model
median_amb_resp = median(fall_neg_daily_amb_emp_data$Responsive_Total_z, na.rm=TRUE)

fall_neg_daily_amb_emp_data$Responsive_Total_med_split = 
  ifelse(fall_neg_daily_amb_emp_data$Responsive_Total_z > median_amb_resp, 
         'hi', 'lo')

# simple effect: high ambient responsiveness [b = 0.20]
hi_agg_amb_resp_mod_stress_model = unique(fall_neg_daily_amb_emp_data) %>% 
  filter(Responsive_Total_med_split == 'hi') %>% 
  lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz, data = ., na.action=na.exclude)

# simple effect: low ambient responsivenecc [b = 0.29]
lo_agg_amb_resp_mod_stress_model = unique(fall_neg_daily_amb_emp_data) %>% 
  filter(Responsive_Total_med_split == 'lo') %>% 
  lm(Stress_day_avg_pz ~ EmoRating_day_mag_pz, data = ., na.action=na.exclude)

```


## Next Steps
* How does disclosure influence wellbeing over longer timescales (quarter, year, etc.)?
* Do qualities of the support provider, such as empathy, influence the utility of disclosing negative events?
* Why do lonely students disclose their stress less frequently?
    + How do they benefit from disclosure vs. their less lonely peers?
    + How do they perceive the impact of their disclosure on the support provider?
    + How does their IRQ-E compare to their less lonely peers?
* To what extent does IRQ-E operate as a self-fulfilling mindset?


```{r, echo=FALSE}
# 1) Look at how loneliness relates to IRQ-T and IRQ-E
  # a) If IRQ-E is lower for lonely students, could there be a self-fulfilling mindset?
# 2) **Do students high in lonliness feel better after disclosing events?
  # a) Compared to students who feel less lonlely?
  # b) **How do lonely students fare at the end of the quarter?
# 3) How do lonely students think others feel after they disclose to them?
  # a) If worse than less lonely students, could this be a potential impedence to disclosure?
```


```{r, echo=FALSE}
# old notes:
# Correlations between loneliness, number of nominations, and "vulnerability ratio."
# Each student was given a "vulnerability ratio," calculated by dividing the number of dorm-mates a student nominates as "providing support during difficult times" by the total number of dorm-mates a student nominates as "close friends." Although this "vulnerability ratio" does not correlate with loneliness, the individual nomination totals do. Unsurprisingly, students who nominate more dorm-mates as "close friends" report experiencing slightly less loneliness, as do students who nominate more dorm-mates as "providing support during difficult times". These two nomination totals are moderately positiviely correlated across students.

# cor.test(trait_data$Loneliness_avg, trait_data$Vulnerability_Ratio) 

# cor.test(trait_data$Loneliness_avg, trait_data$CloseFrd_Total)

# cor.test(trait_data$Loneliness_avg, trait_data$NegEmoSupp_Total)

# cor.test(trait_data$CloseFrd_Total, trait_data$NegEmoSupp_Total)

```


```{r, echo=FALSE}
# old notes:
# Regression analysis for trait anxiety and EmoRating, predicting whether student seeks help.
# Anxiety is not a significant predictor of self-disclosure.

#anxiety_got_help_model = glmer(GotHelp ~ EmoRating_neg_pz*STAI_MEAN_ctr + (1 | ID/Dorm)  + (0 + EmoRating_neg_pz | ID), data=subset(dd_trait_data, (Val_EC==-1)), family=binomial, control=glmerControl(optimizer='bobyqa'))

# summary(anxiety_got_help_model)

```


```{r, echo=FALSE}
# old notes:
# Correlation between anxiety and loneliness.
# Anxiety and loneliness are moderately positively correlated.

# cor.test(trait_data$Loneliness_avg, trait_data$STAI_MEAN)

```


```{r, echo=FALSE}
# old notes:
# Regression analysis for trait depression and EmoRating, predicting whether student seeks help.
# Depression is not a significant predictor of self-disclosure.

#depression_got_help_model = glmer(GotHelp ~ EmoRating_neg_pz*CESD_avg_ctr + (1 | ID/Dorm), data=subset(dd_trait_data, (Val_EC==-1)), family=binomial, control=glmerControl(optimizer='bobyqa'))

# summary(depression_got_help_model)

```


```{r, echo=FALSE}
# old notes:
# Correlation between depression and loneliness.
# Depression and loneliness are strongly positively correlated.

# cor.test(trait_data$Loneliness_avg, trait_data$CESD_avg)

```


```{r, echo=FALSE}
# old notes:
# Regression analysis for perceived stress and EmoRating, predicting whether student seeks help.
# Perceived stress is not a significant predictor of self-disclosure.

#stress_got_help_model = glmer(GotHelp ~ EmoRating_neg_pz*PSS_avg_ctr + (1 | ID/Dorm) + (0 + EmoRating_neg_pz | ID/Dorm), data=subset(dd_trait_data, (Val_EC==-1)), family=binomial, control=glmerControl(optimizer='bobyqa'))

# summary(stress_got_help_model)

```


```{r, echo=FALSE}
# old notes: 
# Correlation between perceived stress and loneliness.
# Perceived stress and loneliness are moderately positively correlated.

# cor.test(trait_data$Loneliness_avg, trait_data$PSS_avg)

```

